<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <script src="/static/marked.min.js"></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weather AI Agent</title>
    <link id="favicon" rel="icon" type="image/png" href="/static/default_icon.png">
    <!-- 使用Flask的url_for函数引用CSS文件 -->
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>

<body>
    <div class="container">
        <header>
            <h1>🌤️ 天气AI助手</h1>
            <p class="subtitle">智能天气监测与建议系统</p>
        </header>

        <!-- 天气显示区域 -->
        <section class="weather-card">
            <div class="card-header">
                <h2>🌡️ 当前天气</h2>
                <button class="btn-small" onclick="refreshWeather()">🔄 刷新</button>
            </div>
            <div class="card-content">
                <div id="weather-info">正在获取位置和天气信息...</div>
                <div class="metadata">
                    <span>最后更新: </span>
                    <span id="last-update">-</span>
                    <span> | 来源: </span>
                    <span id="update-source">-</span>
                </div>
            </div>
        </section>

        <!-- 预警信息区域（始终显示） -->
        <section class="alerts-card" id="alerts-card">
            <div class="card-header">
                <h2>⚠️ 天气预警</h2>
                <span class="badge" id="alerts-count">0</span>
            </div>
            <div class="card-content">
                <div id="alerts-info">暂无预警信息</div>
            </div>
        </section>

        <!-- AI建议区域 -->
        <section class="advice-card">
            <div class="card-header">
                <h2>💡 AI建议</h2>
                <span class="update-badge" id="update-type-badge">-</span>
            </div>
            <div class="card-content">
                <div id="advice-info">点击下方按钮获取个性化建议</div>
                <div class="metadata">
                    <span>更新类型: </span>
                    <span id="advice-update-type">-</span>
                    <span> | 时间: </span>
                    <span id="advice-update-time">-</span>
                </div>
            </div>
        </section>

        <!-- 操作按钮 -->
        <div class="action-buttons">
            <button id="get-advice-btn" class="btn-primary" onclick="getAdvice()">
                💬 给我点建议
            </button>
            <button id="show-history-btn" class="btn-secondary" onclick="toggleHistory()">
                📜 查看历史记录
            </button>
        </div>

        <!-- 历史记录区域 -->
        <section class="history-card" id="history-card" style="display: none;">
            <div class="card-header">
                <h2>📊 历史记录</h2>
                <button class="btn-small" onclick="loadHistory()">🔄 刷新</button>
            </div>
            <div class="card-content">
                <div class="history-controls">
                    <label for="history-limit">显示数量: </label>
                    <select id="history-limit">
                        <option value="5">最近5条</option>
                        <option value="10" selected>最近10条</option>
                        <option value="20">最近20条</option>
                    </select>
                    <button onclick="loadHistory()">应用</button>
                </div>
                <div id="history-info" class="history-list">
                    加载中...
                </div>
            </div>
        </section>

        <!-- 设置（自动更新间隔）放最底部 -->
        <section class="control-panel">
            <h2>⚙️ 控制面板</h2>
            <div class="control-content">
                <div class="control-item">
                    <label for="update-interval">自动更新间隔（秒）:</label>
                    <input type="number" id="update-interval" value="60" min="30" max="3600">
                    <button id="set-interval-btn" onclick="setUpdateInterval()">设置间隔</button>
                </div>
                <div class="control-buttons">
                    <button id="start-scheduler-btn" class="btn-primary" onclick="startScheduler()">
                        ▶️ 启动定时更新
                    </button>
                    <button id="stop-scheduler-btn" class="btn-secondary" onclick="stopScheduler()">
                        ⏹️ 停止定时更新
                    </button>
                </div>
                <div class="status-display">
                    <span>定时更新状态: </span>
                    <span id="scheduler-status" class="status-off">未启动</span>
                    <span id="last-auto-update">最后自动更新: -</span>
                </div>
            </div>
        </section>

        <!-- 位置信息显示 -->
        <footer class="location-info">
            <div>当前位置: <span id="current-location">获取中...</span></div>
            <div>城市: <span id="location-city">-</span></div>
            <div>定位时间: <span id="location-time">-</span></div>
        </footer>
    </div>

    <!-- 使用Flask的url_for函数引用JavaScript文件 -->
    <script src="{{ url_for('static', filename='script.js') }}"></script>
</body>

</html>